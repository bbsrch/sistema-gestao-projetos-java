package conexaodb;

import javax.swing.*;

import model.Usuario;

import java.awt.*;

public class TelaLogin extends JFrame {

    private JTextField campoLogin;
    private JPasswordField campoSenha; // JPasswordField esconde a senha
    private JButton botaoEntrar;

    public TelaLogin() {
        setTitle("Login - Sistema de Gestão de Projetos");
        setSize(400, 250);
        setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);;
        setLocationRelativeTo(null);
        setLayout(null);

        add(new JLabel("Login:")).setBounds(50, 40, 80, 25);
        campoLogin = new JTextField();
        campoLogin.setBounds(140, 40, 180, 25);
        add(campoLogin);

        add(new JLabel("Senha:")).setBounds(50, 80, 80, 25);
        campoSenha = new JPasswordField();
        campoSenha.setBounds(140, 80, 180, 25);
        add(campoSenha);

        botaoEntrar = new JButton("Entrar");
        botaoEntrar.setBounds(150, 140, 100, 30);
        add(botaoEntrar);

        botaoEntrar.addActionListener(e -> {
            String login = campoLogin.getText();
            String senha = new String(campoSenha.getPassword()); // Pega a senha do JPasswordField

            UsuarioDAO dao = new UsuarioDAO();
            Usuario usuarioLogado = dao.validarLogin(login, senha);

            if (usuarioLogado != null) {
                // Login bem-sucedido!
                JOptionPane.showMessageDialog(this, "Bem-vindo, " + usuarioLogado.getNomeCompleto() + "!");
                
                // Abre a tela principal do sistema
                new TelaPrincipal(usuarioLogado); // Ou qualquer outra tela principal que você queira
                
                // Fecha a tela de login
                this.dispose();
            } else {
                // Login falhou
                JOptionPane.showMessageDialog(this, "Login ou senha inválidos.", "Erro", JOptionPane.ERROR_MESSAGE);
            }
        });

        setVisible(true);
    }
}