package view;

import javax.swing.*;

import dao.UsuarioDAO;
import model.Usuario;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class TelaCadastroUsuario extends JFrame {

    // Componentes
    private JLabel labelNome, labelCpf, labelEmail, labelCargo, labelLogin, labelSenha;
    private JTextField campoNome, campoCpf, campoEmail, campoCargo, campoLogin, campoSenha;
    private JButton botaoSalvar;
    private JLabel labelPerfil;
    private JComboBox<String> comboPerfil;

    private Usuario usuarioParaEditar;

    public TelaCadastroUsuario() {
        inicializarComponentes(); 
        setTitle("Cadastro de Novo Usuário");
        setVisible(true);
    }

    public TelaCadastroUsuario(Usuario usuario) {
        inicializarComponentes(); 
        setTitle("Editar Usuário"); 

        this.usuarioParaEditar = usuario; 

        campoNome.setText(usuario.getNomeCompleto());
        campoCpf.setText(usuario.getCpf());
        campoCpf.setEditable(false); // Impede a edição do CPF, que é nossa chave
        campoEmail.setText(usuario.getEmail());
        campoCargo.setText(usuario.getCargo());
        campoLogin.setText(usuario.getLogin());
        campoSenha.setText(usuario.getSenha());
        setVisible(true);
        comboPerfil.setSelectedItem(usuario.getPerfil());
    }

    private void inicializarComponentes() {
        setSize(400, 380); 
        setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
        setLayout(null);
        setLocationRelativeTo(null);

        labelNome = new JLabel("Nome:");
        labelNome.setBounds(20, 20, 80, 25);
        add(labelNome);
        campoNome = new JTextField();
        campoNome.setBounds(100, 20, 250, 25);
        add(campoNome);

        labelCpf = new JLabel("CPF:");
        labelCpf.setBounds(20, 55, 80, 25);
        add(labelCpf);
        campoCpf = new JTextField();
        campoCpf.setBounds(100, 55, 250, 25);
        add(campoCpf);

        labelEmail = new JLabel("E-mail:");
        labelEmail.setBounds(20, 90, 80, 25);
        add(labelEmail);
        campoEmail = new JTextField();
        campoEmail.setBounds(100, 90, 250, 25);
        add(campoEmail);

        labelCargo = new JLabel("Cargo:");
        labelCargo.setBounds(20, 125, 80, 25);
        add(labelCargo);
        campoCargo = new JTextField();
        campoCargo.setBounds(100, 125, 250, 25);
        add(campoCargo);

        // --- NOVO CAMPO DE PERFIL ---
        labelPerfil = new JLabel("Perfil:");
        labelPerfil.setBounds(20, 160, 80, 25);
        add(labelPerfil);
        String[] perfis = {"colaborador", "gerente", "administrador"};
        comboPerfil = new JComboBox<>(perfis);
        comboPerfil.setBounds(100, 160, 250, 25);
        add(comboPerfil);

        labelLogin = new JLabel("Login:");
        labelLogin.setBounds(20, 195, 80, 25);
        add(labelLogin);
        campoLogin = new JTextField();
        campoLogin.setBounds(100, 195, 250, 25);
        add(campoLogin);

        labelSenha = new JLabel("Senha:");
        labelSenha.setBounds(20, 230, 80, 25);
        add(labelSenha);
        campoSenha = new JPasswordField();
        campoSenha.setBounds(100, 230, 250, 25);
        add(campoSenha);

        botaoSalvar = new JButton("Salvar");
        botaoSalvar.setBounds(150, 280, 100, 30);
        add(botaoSalvar);

        // --- Lógica do Botão ---
        botaoSalvar.addActionListener(e -> {
            Usuario usuario = new Usuario();
            usuario.setNomeCompleto(campoNome.getText());
            usuario.setCpf(campoCpf.getText());
            usuario.setEmail(campoEmail.getText());
            usuario.setCargo(campoCargo.getText());
            usuario.setLogin(campoLogin.getText());
            if (campoSenha instanceof JPasswordField) {
                usuario.setSenha(new String(((JPasswordField) campoSenha).getPassword()));
            } else {
                usuario.setSenha(campoSenha.getText());
            }

            usuario.setPerfil((String) comboPerfil.getSelectedItem());
            
            UsuarioDAO dao = new UsuarioDAO();

            if (usuarioParaEditar == null) {
                dao.cadastrar(usuario);
                JOptionPane.showMessageDialog(this, "Usuário cadastrado com sucesso!");
            } else {
                dao.atualizar(usuario);
                JOptionPane.showMessageDialog(this, "Usuário atualizado com sucesso!");
            }

            this.dispose();
        });
    }
}